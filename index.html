<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>縦書き台本整形ツール</title>
        
        <link rel="stylesheet" href="styles.css">
    </head>
    
    <body>
        <!--
        ========================================
        メインアプリケーション構造
        ========================================
        3カラムレイアウト
        -->
        <div class="container-fluid full-height">
            <div class="row h-100">
                <!-- 左カラム：使い方 / 柱書アウトライン -->
                <div class="col-2 left-column">
                    <div class="left-tab-bar">
                        <button class="left-tab-btn active" id="tab-btn-usage" onclick="switchLeftTab('usage')">使い方</button>
                        <button class="left-tab-btn" id="tab-btn-outline" onclick="switchLeftTab('outline')">柱書</button>
                    </div>
                    <div class="column-content">
                        <div id="panel-usage" class="left-panel">
                        <h5>使い方</h5>

                        <!-- 推奨環境 -->
                        <div class="mb-4">
                            <h6 class="text-primary">推奨環境</h6>
                            <small class="text-muted">
                                Chrome または Edgeを推奨。<br>
                                Firefox、Safariでは、印刷時にレイアウトが崩れる場合があります。
                            </small>
                        </div>

                        <!-- 基本操作説明 -->
                        <div class="mb-4">
                            <h6 class="text-primary">基本操作</h6>
                            <small class="text-muted">
                                中央のエディターにテキストを入力すると、右側にB5縦書きプレビューが表示されます。
                            </small>
                        </div>

                        <!-- 柱書機能説明 -->
                        <div class="mb-4">
                            <h6 class="text-primary">柱書</h6>
                            <small class="text-muted">
                                <strong>自動連番：</strong>行頭に「◯○◎◇□＊☆」のいずれかを入力すると柱書として認識され、プレビューでは自動的に番号が振られます。<br>
                                <strong>手動指定：</strong>番号を手動で指定する場合は、上記の記号の前に、隅付き括弧【】で囲んで入力してください。<br>
                                <strong>例：</strong><br>
                                • ◯ → 「８」（自動連番）<br>
                                • 【８A】◯ → 「８A」<br>
                                <em>※手動指定は自動連番のカウントには影響しません</em>
                            </small>
                        </div>

                        <!-- 柱書リスト -->
                        <div class="mb-4">
                            <h6 class="text-primary">柱書リスト</h6>
                            <small class="text-muted">
                                この上部にある「柱書」タブを開くと、柱書の一覧が表示されます。クリックすると該当箇所にジャンプします。
                            </small>
                        </div>

                        <!-- ト書き機能説明 -->
                        <div class="mb-4">
                            <h6 class="text-primary">ト書き</h6>
                            <small class="text-muted">
                                ト書きとしてインデント（字下げ）をするときは、行頭にスペースを入れて調整してください（５文字を推奨）。折り返し部分にも自動適用されます。
                            </small>
                        </div>

                        <!-- セリフ行機能説明 -->
                        <div class="mb-4">
                            <h6 class="text-primary">セリフ行</h6>
                            <small class="text-muted">
                                カギカッコ「」で終わる行はセリフ行として、折り返し部分に4文字のインデントが自動適用されます。
                            </small>
                        </div>

                        <!-- レイアウト仕様説明 -->
                        <div class="mb-4">
                            <h6 class="text-primary">レイアウト</h6>
                            <small class="text-muted">
                                • 1ページ：17行<br>
                                • 1行：29文字<br>
                                • 自動改ページ<br>
                                • 日本語禁則処理対応
                            </small>
                        </div>

                        <!-- 印刷機能説明 -->
                        <div class="mb-4">
                            <h6 class="text-primary">印刷</h6>
                            <small class="text-muted">
                                右上の「印刷」ボタンでB5サイズの縦書き原稿として印刷できます。<br>
                                <strong>印刷設定：</strong><br>
                                • 用紙サイズ：B5<br>
                                • 向き：縦<br>
                                • 余白：25mm（上）、9mm（左右）、0mm（下）<br>
                                <strong>用紙、余白、倍率など、適宜調整してください。</strong><br>
                            </small>
                        </div>

                        <!-- ファイル保存の説明 -->
                        <div class="mb-4">
                            <h6 class="text-primary">テキスト保存</h6>
                            <small class="text-muted">
                                ショートカットキーは、<strong>Ctrl + S</strong>（Win）<strong>Cmd + S</strong>（Mac）です。<br>
                                Chrome・Edgeでは開いたファイルへの上書き保存が可能です。
                            </small>
                        </div>

                        <!-- プレビューとの連動 -->
                        <div class="mb-4">
                            <h6 class="text-primary">プレビューとの連動</h6>
                            <small class="text-muted">
                                プレビューのテキストをクリックすると、対応する行にエディターがジャンプします。マウスオーバーで該当箇所がハイライト表示されます。
                            </small>
                        </div>

                        <!-- カラム幅の変更 -->
                        <div class="mb-4">
                            <h6 class="text-primary">カラム幅の変更</h6>
                            <small class="text-muted">
                                カラム間の仕切りをドラッグすると、各カラムの幅を自由に変更できます。
                            </small>
                        </div>
                        
                        <!-- バージョン情報 -->
                        <div class="mt-5 pt-3 border-top">
                            <small class="text-muted">
                                <strong>縦書き台本整形ツール<br></strong>
                                ver.26.3.1
                            </small>
                        </div>
                        
                        <!-- GitHubリンク -->
                        <div class="mt-3">
                            <small class="text-muted">
                                <a href="https://github.com/kzbb/straw" target="_blank" class="text-decoration-none text-primary">
                                    README (GitHub)
                                </a>
                            </small>
                        </div>

                        <!-- フィードバックフォームリンク -->
                        <div class="mt-3">
                            <small class="text-muted">
                                <a href="https://docs.google.com/forms/d/e/1FAIpQLSeJ1db2A8czL_-DNfx0srZvzYDZ1poMQXANdVSJiEIJyFhUtA/viewform?usp=header" target="_blank" class="text-decoration-none text-primary">
                                    フィードバックフォーム
                                </a>
                            </small>
                        </div>

                        </div><!-- /panel-usage -->

                        <div id="panel-outline" class="left-panel" hidden>
                            <div id="scene-list"></div>
                        </div><!-- /panel-outline -->

                    </div>
                </div>
                <div class="col-divider" id="divider-left"></div>

                <!--
                ========================================
                中央カラム：テキストエディター
                ========================================
                メインの入力インターフェース
                -->
                <div class="col-5 center-column">
                    <!-- エディターメニューバー -->
                    <div class="editor-menu-bar">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">テキストエディター</h5>
                            <div>
                                <!-- ファイル操作ボタン群 -->
                                <button class="btn btn-outline-primary btn-sm me-2" onclick="loadText()">
                                    ファイルを開く
                                </button>
                                <button class="btn btn-success btn-sm me-1" onclick="saveText()">
                                    保存
                                </button>
                                <button class="btn btn-outline-success btn-sm" onclick="saveAsText()">
                                    名前を付けて保存
                                </button>
                                <!-- 隠しファイル入力要素（プログラムからトリガー） -->
                                <input type="file" id="fileInput" accept=".txt" style="display: none;" onchange="handleFileSelect(event)">
                            </div>
                        </div>
                    </div>
                    
                    <!-- エディター本体 -->
                    <div class="editor-container">
                        <!-- ジャンプ位置計算用ミラー（不可視・テキスト構造を保持） -->
                        <div id="editor-mirror" class="code-editor-mirror" aria-hidden="true"></div>
                        <textarea
                            class="code-editor"
                            id="editor"
                            placeholder="// ここにテキストを入力してください..."></textarea>
                    </div>
                </div>
                <div class="col-divider" id="divider-right"></div>

                <!--
                ========================================
                右カラム：縦書きプレビュー
                ========================================
                リアルタイム縦書き表示とページプレビュー
                -->
                <div class="col-5 right-column">
                    <div class="column-content">
                        <!-- プレビューヘッダー -->
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5>プレビュー</h5>
                            <div class="text-end">
                                <button class="btn btn-primary btn-sm" onclick="printPages()">
                                    印刷
                                </button>
                                <small class="d-block text-muted mt-1" style="white-space: nowrap;">
                                    ※印刷設定でB5用紙を選択してください
                                </small>
                            </div>
                        </div>
                        <!-- B5ページプレビューコンテナ（JavaScriptで動的生成） -->
                        <div id="pages-container"></div>
                    </div>
                </div>
            </div>
        </div>

        <script src="app.js"></script>
    </body>
</html>
